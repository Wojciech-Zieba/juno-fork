# Stage 1: Build binaries using goreleaser
FROM golang:1.19-alpine AS goreleaser

WORKDIR /app

# Install goreleaser
RUN apk add --no-cache git
RUN go install github.com/goreleaser/goreleaser@latest

# Copy source code
COPY . .

# Build the project with goreleaser
RUN goreleaser build --single-target --rm-dist

# Stage 2: Build Docker image
FROM alpine:3.14 AS runtime

# Find the built binary and copy it
COPY --from=goreleaser /app/dist/*/* /usr/local/bin/juno

ENTRYPOINT ["juno"]
